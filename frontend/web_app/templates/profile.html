<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ user.full_name or "User" }} - Profile Settings | EduGenie</title>
    <link rel="stylesheet" href="{{ url_for('static', path='/css/landing.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', path='/css/profile.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', path='/css/auth_nav.css') }}">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <meta name="description" content="Manage your EduGenie profile, learning preferences, and account settings">
</head>
<body>    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-container">
            <a href="/" class="nav-brand">
                <i class="fas fa-magic"></i>
                <span>EduGenie</span>
            </a>
            <div class="nav-menu">
                <a href="/dashboard" class="nav-link">
                    <i class="fas fa-home"></i>
                    Dashboard
                </a>
                <a href="/courses" class="nav-link">
                    <i class="fas fa-book"></i>
                    Courses
                </a>
                <a href="/progress" class="nav-link">
                    <i class="fas fa-chart-line"></i>
                    Progress
                </a>                <a href="/learning" class="nav-link">
                    <i class="fas fa-graduation-cap"></i>
                    Study
                </a>
            </div>
            <div class="nav-actions">
                <!-- Enhanced user menu -->
                <div class="nav-user-menu" id="nav-user-menu">                    <div class="nav-user-info" id="nav-user-toggle">
                        <img src="{{ user.avatar_url or url_for('static', path='/images/profile-logo.svg') }}" 
                             alt="Profile" class="nav-avatar profile-logo">
                        <div class="nav-user-details">
                            <span class="nav-user-name">{{ user.full_name or "User" }}</span>
                            <span class="nav-user-level">{{ user.subscription_plan | title or "Free" }} Member</span>
                        </div>
                        <i class="fas fa-chevron-down nav-dropdown-icon"></i>
                    </div>
                    <div class="nav-user-dropdown" id="nav-user-dropdown">
                        <!-- Dropdown Header with user info -->
                        <div class="dropdown-header">
                            <img src="{{ user.avatar_url or url_for('static', path='/images/profile-logo.svg') }}" 
                                 alt="Profile" class="dropdown-avatar profile-logo">
                            <div class="dropdown-user-info">
                                <div class="dropdown-name">{{ user.full_name or "User" }}</div>
                                <div class="dropdown-email">{{ user.email }}</div>
                                <div class="dropdown-status">
                                    <span class="status-badge {{ user.subscription_plan or 'free' }}">
                                        {{ user.subscription_plan | title or "Free" }} Member
                                    </span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Profile & Account -->
                        <div class="dropdown-section">
                            <div class="section-title">Profile & Account</div>
                            <a href="/profile" class="dropdown-item active">
                                <i class="fas fa-user"></i>
                                <span>Profile Settings</span>
                                <span class="item-badge">Current</span>
                            </a>
                            <a href="/dashboard" class="dropdown-item">
                                <i class="fas fa-tachometer-alt"></i>
                                <span>Dashboard</span>
                            </a>
                            <a href="/settings" class="dropdown-item">
                                <i class="fas fa-cog"></i>
                                <span>Account Settings</span>
                            </a>
                        </div>
                        
                        <!-- Learning & Progress -->
                        <div class="dropdown-section">
                            <div class="section-title">Learning & Progress</div>
                            <a href="/courses" class="dropdown-item">
                                <i class="fas fa-book"></i>
                                <span>My Courses</span>
                            </a>
                            <a href="/progress" class="dropdown-item">
                                <i class="fas fa-chart-line"></i>
                                <span>Progress Report</span>
                            </a>
                            <a href="/achievements" class="dropdown-item">
                                <i class="fas fa-trophy"></i>
                                <span>Achievements</span>
                            </a>
                        </div>
                        
                        <!-- Billing & Support -->
                        <div class="dropdown-section">
                            <div class="section-title">Billing & Support</div>
                            <a href="/billing" class="dropdown-item">
                                <i class="fas fa-credit-card"></i>
                                <span>Billing & Plans</span>
                            </a>
                            <a href="/help" class="dropdown-item">
                                <i class="fas fa-question-circle"></i>
                                <span>Help & Support</span>
                            </a>
                        </div>
                        
                        <div class="dropdown-divider"></div>
                        
                        <!-- Sign Out -->
                        <a href="/api/logout" class="dropdown-item signout-item">
                            <i class="fas fa-sign-out-alt"></i>
                            <span>Sign Out</span>
                        </a>
                    </div>
                </div>
                
                <!-- Mobile menu toggle -->
                <div class="mobile-menu-toggle" id="mobile-menu-toggle">
                    <i class="fas fa-bars"></i>
                </div>
            </div>
        </div>
        
        <!-- Mobile Navigation Menu -->
        <div class="mobile-nav-menu" id="mobile-nav-menu">
            <div class="mobile-nav-header">
                <img src="{{ user.avatar_url or url_for('static', path='/images/default-avatar.svg') }}" 
                     alt="Profile" class="mobile-avatar">
                <div class="mobile-user-info">
                    <div class="mobile-user-name">{{ user.full_name or "User" }}</div>
                    <div class="mobile-user-email">{{ user.email }}</div>
                </div>
            </div>
            
            <div class="mobile-nav-links">
                <a href="/dashboard" class="mobile-nav-link">
                    <i class="fas fa-home"></i>
                    Dashboard
                </a>
                <a href="/courses" class="mobile-nav-link">
                    <i class="fas fa-book"></i>
                    Courses
                </a>
                <a href="/progress" class="mobile-nav-link">
                    <i class="fas fa-chart-line"></i>
                    Progress
                </a>
                <a href="/profile" class="mobile-nav-link active">
                    <i class="fas fa-user"></i>
                    Profile
                </a>
                <a href="/settings" class="mobile-nav-link">
                    <i class="fas fa-cog"></i>
                    Settings
                </a>
                <a href="/api/logout" class="mobile-nav-link signout">
                    <i class="fas fa-sign-out-alt"></i>
                    Sign Out
                </a>
            </div>
        </div>
    </nav>
                        <a href="/api/logout" class="dropdown-item">
                            <i class="fas fa-sign-out-alt"></i>
                            Sign Out
                        </a>
                    </div>
                </div>
            </div>
            <div class="mobile-menu-toggle">
                <i class="fas fa-bars"></i>
            </div>
        </div>
    </nav>

    <!-- Profile Content -->
    <main class="profile-main">
        <div class="profile-container">
            <!-- Profile Header -->
            <div class="profile-header">
                <div class="profile-header-content">
                    <div class="profile-avatar-section">
                        <div class="profile-avatar-container">
                            <img src="{{ user.avatar_url or url_for('static', path='/images/default-avatar.svg') }}" 
                                 alt="Profile Avatar" class="profile-avatar" id="profile-avatar">
                            <div class="avatar-overlay">
                                <i class="fas fa-camera"></i>
                                <span>Change Photo</span>
                            </div>
                            <input type="file" id="avatar-upload" accept="image/*" style="display: none;">
                        </div>
                        <div class="profile-status">
                            <div class="status-badge {{ user.subscription_plan or 'free' }}">
                                <i class="fas fa-{{ 'crown' if user.subscription_plan == 'pro' else 'star' if user.subscription_plan == 'premium' else 'user' }}"></i>
                                {{ (user.subscription_plan or 'free') | title }} Member
                            </div>
                        </div>
                    </div>
                    
                    <div class="profile-info">
                        <h1 class="profile-name">{{ user.full_name or "Welcome!" }}</h1>
                        <p class="profile-email">{{ user.email }}</p>
                        <div class="profile-stats">
                            <div class="stat-item">
                                <div class="stat-value">{{ user_stats.courses_completed or 0 }}</div>
                                <div class="stat-label">Courses Completed</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value">{{ user_stats.study_hours or 0 }}</div>
                                <div class="stat-label">Study Hours</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value">{{ user_stats.achievements or 0 }}</div>
                                <div class="stat-label">Achievements</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value">{{ user_stats.streak_days or 0 }}</div>
                                <div class="stat-label">Day Streak</div>
                            </div>
                        </div>
                        <div class="profile-actions">
                            <button class="btn btn-primary" onclick="editProfile()">
                                <i class="fas fa-edit"></i>
                                Edit Profile
                            </button>
                            <button class="btn btn-outline" onclick="shareProfile()">
                                <i class="fas fa-share"></i>
                                Share Profile
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Progress Overview -->
                <div class="progress-overview">
                    <div class="progress-card">
                        <h3><i class="fas fa-target"></i> Current Goals</h3>
                        <div class="goal-item">
                            <div class="goal-info">
                                <span class="goal-title">Complete Python Fundamentals</span>
                                <span class="goal-deadline">Due: {{ current_goal.deadline or "No deadline" }}</span>
                            </div>
                            <div class="goal-progress">
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: {{ current_goal.progress or 65 }}%"></div>
                                </div>
                                <span class="progress-text">{{ current_goal.progress or 65 }}%</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="progress-card">
                        <h3><i class="fas fa-chart-line"></i> Learning Streak</h3>
                        <div class="streak-calendar">
                            <div class="calendar-week">
                                <div class="calendar-day active" data-day="Mon">M</div>
                                <div class="calendar-day active" data-day="Tue">T</div>
                                <div class="calendar-day active" data-day="Wed">W</div>
                                <div class="calendar-day active" data-day="Thu">T</div>
                                <div class="calendar-day active" data-day="Fri">F</div>
                                <div class="calendar-day" data-day="Sat">S</div>
                                <div class="calendar-day" data-day="Sun">S</div>
                            </div>
                            <p class="streak-text">{{ user_stats.streak_days or 5 }} day streak! Keep it up! ðŸ”¥</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Profile Tabs -->
            <div class="profile-tabs">
                <nav class="tab-nav">
                    <button class="tab-btn active" data-tab="personal">
                        <i class="fas fa-user"></i>
                        Personal Info
                    </button>
                    <button class="tab-btn" data-tab="learning">
                        <i class="fas fa-graduation-cap"></i>
                        Learning Preferences
                    </button>
                    <button class="tab-btn" data-tab="security">
                        <i class="fas fa-shield-alt"></i>
                        Security
                    </button>
                    <button class="tab-btn" data-tab="notifications">
                        <i class="fas fa-bell"></i>
                        Notifications
                    </button>
                    <button class="tab-btn" data-tab="achievements">
                        <i class="fas fa-trophy"></i>
                        Achievements
                    </button>
                </nav>
            </div>

            <!-- Tab Content -->
            <div class="tab-content">
                <!-- Personal Information Tab -->
                <div class="tab-pane active" id="personal-tab">
                    <div class="settings-section">
                        <h2>Personal Information</h2>
                        <p class="section-description">Update your personal details and contact information.</p>
                        
                        <form class="profile-form" id="personal-form">
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="full_name" class="form-label">
                                        <i class="fas fa-user"></i>
                                        Full Name
                                    </label>
                                    <input type="text" id="full_name" name="full_name" 
                                           class="form-input" value="{{ user.full_name or '' }}" 
                                           placeholder="Enter your full name">
                                </div>
                                <div class="form-group">
                                    <label for="username" class="form-label">
                                        <i class="fas fa-at"></i>
                                        Username
                                    </label>
                                    <input type="text" id="username" name="username" 
                                           class="form-input" value="{{ user.username or '' }}" 
                                           placeholder="Choose a username">
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="email" class="form-label">
                                        <i class="fas fa-envelope"></i>
                                        Email Address
                                    </label>
                                    <input type="email" id="email" name="email" 
                                           class="form-input" value="{{ user.email }}" 
                                           readonly>
                                    <div class="input-note">
                                        <i class="fas fa-info-circle"></i>
                                        Contact support to change your email address
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="phone" class="form-label">
                                        <i class="fas fa-phone"></i>
                                        Phone Number
                                    </label>
                                    <input type="tel" id="phone" name="phone" 
                                           class="form-input" value="{{ user.phone or '' }}" 
                                           placeholder="+1 (555) 000-0000">
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="location" class="form-label">
                                        <i class="fas fa-map-marker-alt"></i>
                                        Location
                                    </label>
                                    <input type="text" id="location" name="location" 
                                           class="form-input" value="{{ user.location or '' }}" 
                                           placeholder="City, Country">
                                </div>
                                <div class="form-group">
                                    <label for="timezone" class="form-label">
                                        <i class="fas fa-clock"></i>
                                        Timezone
                                    </label>
                                    <select id="timezone" name="timezone" class="form-select">
                                        <option value="UTC" {{ 'selected' if user.timezone == 'UTC' else '' }}>UTC (GMT+0)</option>
                                        <option value="US/Eastern" {{ 'selected' if user.timezone == 'US/Eastern' else '' }}>Eastern Time (GMT-5)</option>
                                        <option value="US/Pacific" {{ 'selected' if user.timezone == 'US/Pacific' else '' }}>Pacific Time (GMT-8)</option>
                                        <option value="Europe/London" {{ 'selected' if user.timezone == 'Europe/London' else '' }}>London (GMT+0)</option>
                                        <option value="Asia/Tokyo" {{ 'selected' if user.timezone == 'Asia/Tokyo' else '' }}>Tokyo (GMT+9)</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label for="bio" class="form-label">
                                    <i class="fas fa-align-left"></i>
                                    Bio
                                </label>
                                <textarea id="bio" name="bio" class="form-textarea" rows="4" 
                                          placeholder="Tell us a bit about yourself and your learning goals...">{{ user.bio or '' }}</textarea>
                                <div class="character-count">
                                    <span id="bio-count">{{ (user.bio or '') | length }}</span>/500 characters
                                </div>
                            </div>
                            
                            <div class="form-actions">
                                <button type="button" class="btn btn-outline" onclick="resetForm('personal-form')">
                                    <i class="fas fa-undo"></i>
                                    Reset
                                </button>
                                <button type="submit" class="btn btn-primary">
                                    <i class="fas fa-save"></i>
                                    Save Changes
                                </button>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Learning Preferences Tab -->
                <div class="tab-pane" id="learning-tab">
                    <div class="settings-section">
                        <h2>Learning Preferences</h2>
                        <p class="section-description">Customize your learning experience to match your goals and style.</p>
                        
                        <form class="profile-form" id="learning-form">
                            <div class="preference-section">
                                <h3>Learning Style</h3>
                                <div class="preference-grid">
                                    <label class="preference-card">
                                        <input type="radio" name="learning_style" value="visual" 
                                               {{ 'checked' if user.learning_style == 'visual' else '' }}>
                                        <div class="card-content">
                                            <i class="fas fa-eye"></i>
                                            <h4>Visual</h4>
                                            <p>Learn through images, diagrams, and visual aids</p>
                                        </div>
                                    </label>
                                    <label class="preference-card">
                                        <input type="radio" name="learning_style" value="auditory" 
                                               {{ 'checked' if user.learning_style == 'auditory' else '' }}>
                                        <div class="card-content">
                                            <i class="fas fa-volume-up"></i>
                                            <h4>Auditory</h4>
                                            <p>Learn through listening and verbal instruction</p>
                                        </div>
                                    </label>
                                    <label class="preference-card">
                                        <input type="radio" name="learning_style" value="kinesthetic" 
                                               {{ 'checked' if user.learning_style == 'kinesthetic' else '' }}>
                                        <div class="card-content">
                                            <i class="fas fa-hand-paper"></i>
                                            <h4>Kinesthetic</h4>
                                            <p>Learn through hands-on practice and activities</p>
                                        </div>
                                    </label>
                                    <label class="preference-card">
                                        <input type="radio" name="learning_style" value="reading" 
                                               {{ 'checked' if user.learning_style == 'reading' else '' }}>
                                        <div class="card-content">
                                            <i class="fas fa-book"></i>
                                            <h4>Reading/Writing</h4>
                                            <p>Learn through reading and note-taking</p>
                                        </div>
                                    </label>
                                </div>
                            </div>
                            
                            <div class="preference-section">
                                <h3>Study Schedule</h3>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="study_time_preference" class="form-label">
                                            <i class="fas fa-clock"></i>
                                            Preferred Study Time
                                        </label>
                                        <select id="study_time_preference" name="study_time_preference" class="form-select">
                                            <option value="morning" {{ 'selected' if user.study_time_preference == 'morning' else '' }}>Morning (6AM - 12PM)</option>
                                            <option value="afternoon" {{ 'selected' if user.study_time_preference == 'afternoon' else '' }}>Afternoon (12PM - 6PM)</option>
                                            <option value="evening" {{ 'selected' if user.study_time_preference == 'evening' else '' }}>Evening (6PM - 10PM)</option>
                                            <option value="night" {{ 'selected' if user.study_time_preference == 'night' else '' }}>Night (10PM - 12AM)</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="daily_study_goal" class="form-label">
                                            <i class="fas fa-target"></i>
                                            Daily Study Goal (minutes)
                                        </label>
                                        <input type="number" id="daily_study_goal" name="daily_study_goal" 
                                               class="form-input" min="15" max="480" step="15"
                                               value="{{ user.daily_study_goal or 60 }}">
                                    </div>
                                </div>
                            </div>
                            
                            <div class="preference-section">
                                <h3>Learning Goals</h3>
                                <div class="form-group">
                                    <label for="learning_goal" class="form-label">
                                        <i class="fas fa-bullseye"></i>
                                        Primary Learning Goal
                                    </label>
                                    <select id="learning_goal" name="learning_goal" class="form-select">
                                        <option value="skill_development" {{ 'selected' if user.learning_goal == 'skill_development' else '' }}>Skill Development</option>
                                        <option value="career_advancement" {{ 'selected' if user.learning_goal == 'career_advancement' else '' }}>Career Advancement</option>
                                        <option value="academic_support" {{ 'selected' if user.learning_goal == 'academic_support' else '' }}>Academic Support</option>
                                        <option value="exam_preparation" {{ 'selected' if user.learning_goal == 'exam_preparation' else '' }}>Exam Preparation</option>
                                        <option value="personal_interest" {{ 'selected' if user.learning_goal == 'personal_interest' else '' }}>Personal Interest</option>
                                    </select>
                                </div>
                                
                                <div class="form-group">
                                    <label for="experience_level" class="form-label">
                                        <i class="fas fa-layer-group"></i>
                                        Experience Level
                                    </label>
                                    <select id="experience_level" name="experience_level" class="form-select">
                                        <option value="beginner" {{ 'selected' if user.experience_level == 'beginner' else '' }}>Beginner</option>
                                        <option value="intermediate" {{ 'selected' if user.experience_level == 'intermediate' else '' }}>Intermediate</option>
                                        <option value="advanced" {{ 'selected' if user.experience_level == 'advanced' else '' }}>Advanced</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="preference-section">
                                <h3>Subject Interests</h3>
                                <div class="subjects-grid">
                                    {% for subject in available_subjects %}
                                    <label class="subject-tag">
                                        <input type="checkbox" name="preferred_subjects" value="{{ subject.id }}"
                                               {{ 'checked' if subject.id in (user.preferred_subjects or []) else '' }}>
                                        <span class="subject-name">
                                            <i class="{{ subject.icon }}"></i>
                                            {{ subject.name }}
                                        </span>
                                    </label>
                                    {% endfor %}
                                </div>
                            </div>
                            
                            <div class="form-actions">
                                <button type="button" class="btn btn-outline" onclick="resetForm('learning-form')">
                                    <i class="fas fa-undo"></i>
                                    Reset
                                </button>
                                <button type="submit" class="btn btn-primary">
                                    <i class="fas fa-save"></i>
                                    Save Preferences
                                </button>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Security Tab -->
                <div class="tab-pane" id="security-tab">
                    <div class="settings-section">
                        <h2>Security Settings</h2>
                        <p class="section-description">Manage your account security and privacy settings.</p>
                        
                        <!-- Password Change -->
                        <div class="security-card">
                            <div class="security-header">
                                <h3><i class="fas fa-key"></i> Change Password</h3>
                                <p>Update your password to keep your account secure</p>
                            </div>
                            <form class="security-form" id="password-form">
                                <div class="form-group">
                                    <label for="current_password" class="form-label">Current Password</label>
                                    <div class="password-input-container">
                                        <input type="password" id="current_password" name="current_password" 
                                               class="form-input" placeholder="Enter current password" required>
                                        <button type="button" class="password-toggle" onclick="togglePassword('current_password')">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                    </div>
                                </div>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="new_password" class="form-label">New Password</label>
                                        <div class="password-input-container">
                                            <input type="password" id="new_password" name="new_password" 
                                                   class="form-input" placeholder="Enter new password" required>
                                            <button type="button" class="password-toggle" onclick="togglePassword('new_password')">
                                                <i class="fas fa-eye"></i>
                                            </button>
                                        </div>
                                        <div class="password-strength-meter" id="new-password-strength">
                                            <div class="strength-bar">
                                                <div class="strength-fill"></div>
                                            </div>
                                            <span class="strength-text">Password strength</span>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label for="confirm_password" class="form-label">Confirm Password</label>
                                        <div class="password-input-container">
                                            <input type="password" id="confirm_password" name="confirm_password" 
                                                   class="form-input" placeholder="Confirm new password" required>
                                            <button type="button" class="password-toggle" onclick="togglePassword('confirm_password')">
                                                <i class="fas fa-eye"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                <button type="submit" class="btn btn-primary">
                                    <i class="fas fa-shield-alt"></i>
                                    Update Password
                                </button>
                            </form>
                        </div>
                        
                        <!-- Two-Factor Authentication -->
                        <div class="security-card">
                            <div class="security-header">
                                <h3><i class="fas fa-mobile-alt"></i> Two-Factor Authentication</h3>
                                <p>Add an extra layer of security to your account</p>
                            </div>
                            <div class="security-status">
                                <div class="status-indicator {{ 'enabled' if user.two_factor_enabled else 'disabled' }}">
                                    <i class="fas fa-{{ 'check-circle' if user.two_factor_enabled else 'times-circle' }}"></i>
                                    <span>{{ 'Enabled' if user.two_factor_enabled else 'Disabled' }}</span>
                                </div>
                                <button class="btn {{ 'btn-outline' if user.two_factor_enabled else 'btn-primary' }}" 
                                        onclick="toggle2FA()">
                                    {{ 'Disable' if user.two_factor_enabled else 'Enable' }} 2FA
                                </button>
                            </div>
                        </div>
                        
                        <!-- Connected Accounts -->
                        <div class="security-card">
                            <div class="security-header">
                                <h3><i class="fas fa-link"></i> Connected Accounts</h3>
                                <p>Manage your social login connections</p>
                            </div>
                            <div class="connected-accounts">
                                <div class="account-item">
                                    <div class="account-info">
                                        <i class="fab fa-google"></i>
                                        <span>Google</span>
                                    </div>
                                    <div class="account-status">
                                        {% if 'google' in (user.oauth_providers or {}) %}
                                        <span class="status-badge connected">Connected</span>
                                        <button class="btn btn-outline btn-sm" onclick="disconnectAccount('google')">Disconnect</button>
                                        {% else %}
                                        <span class="status-badge not-connected">Not Connected</span>
                                        <button class="btn btn-primary btn-sm" onclick="connectAccount('google')">Connect</button>
                                        {% endif %}
                                    </div>
                                </div>
                                <div class="account-item">
                                    <div class="account-info">
                                        <i class="fab fa-github"></i>
                                        <span>GitHub</span>
                                    </div>
                                    <div class="account-status">
                                        {% if 'github' in (user.oauth_providers or {}) %}
                                        <span class="status-badge connected">Connected</span>
                                        <button class="btn btn-outline btn-sm" onclick="disconnectAccount('github')">Disconnect</button>
                                        {% else %}
                                        <span class="status-badge not-connected">Not Connected</span>
                                        <button class="btn btn-primary btn-sm" onclick="connectAccount('github')">Connect</button>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Active Sessions -->
                        <div class="security-card">
                            <div class="security-header">
                                <h3><i class="fas fa-devices"></i> Active Sessions</h3>
                                <p>Monitor and manage your active login sessions</p>
                            </div>
                            <div class="sessions-list">
                                {% for session in user_sessions %}
                                <div class="session-item {{ 'current' if session.is_current else '' }}">
                                    <div class="session-info">
                                        <div class="session-device">
                                            <i class="fas fa-{{ session.device_type }}"></i>
                                            <span>{{ session.device_name }}</span>
                                            {% if session.is_current %}
                                            <span class="current-badge">Current</span>
                                            {% endif %}
                                        </div>
                                        <div class="session-details">
                                            <span>{{ session.location }}</span>
                                            <span>Last active: {{ session.last_active }}</span>
                                        </div>
                                    </div>
                                    {% if not session.is_current %}
                                    <button class="btn btn-outline btn-sm" onclick="revokeSession('{{ session.id }}')">
                                        Revoke
                                    </button>
                                    {% endif %}
                                </div>
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Notifications Tab -->
                <div class="tab-pane" id="notifications-tab">
                    <div class="settings-section">
                        <h2>Notification Preferences</h2>
                        <p class="section-description">Choose how and when you want to receive notifications.</p>
                        
                        <form class="profile-form" id="notifications-form">
                            <div class="notification-section">
                                <h3>Email Notifications</h3>
                                <div class="notification-options">
                                    <label class="notification-item">
                                        <div class="notification-info">
                                            <h4>Course Updates</h4>
                                            <p>New lessons, assignments, and course announcements</p>
                                        </div>
                                        <label class="toggle-switch">
                                            <input type="checkbox" name="email_course_updates" 
                                                   {{ 'checked' if user.notifications.email_course_updates else '' }}>
                                            <span class="toggle-slider"></span>
                                        </label>
                                    </label>
                                    
                                    <label class="notification-item">
                                        <div class="notification-info">
                                            <h4>Progress Reminders</h4>
                                            <p>Daily and weekly learning reminders and progress updates</p>
                                        </div>
                                        <label class="toggle-switch">
                                            <input type="checkbox" name="email_progress_reminders" 
                                                   {{ 'checked' if user.notifications.email_progress_reminders else '' }}>
                                            <span class="toggle-slider"></span>
                                        </label>
                                    </label>
                                    
                                    <label class="notification-item">
                                        <div class="notification-info">
                                            <h4>Achievement Notifications</h4>
                                            <p>Certificates, badges, and milestone achievements</p>
                                        </div>
                                        <label class="toggle-switch">
                                            <input type="checkbox" name="email_achievements" 
                                                   {{ 'checked' if user.notifications.email_achievements else '' }}>
                                            <span class="toggle-slider"></span>
                                        </label>
                                    </label>
                                </div>
                            </div>
                            
                            <div class="notification-section">
                                <h3>Push Notifications</h3>
                                <div class="notification-options">
                                    <label class="notification-item">
                                        <div class="notification-info">
                                            <h4>Study Reminders</h4>
                                            <p>Notifications to help you stick to your study schedule</p>
                                        </div>
                                        <label class="toggle-switch">
                                            <input type="checkbox" name="push_study_reminders" 
                                                   {{ 'checked' if user.notifications.push_study_reminders else '' }}>
                                            <span class="toggle-slider"></span>
                                        </label>
                                    </label>
                                    
                                    <label class="notification-item">
                                        <div class="notification-info">
                                            <h4>Live Session Alerts</h4>
                                            <p>Upcoming live classes and Q&A sessions</p>
                                        </div>
                                        <label class="toggle-switch">
                                            <input type="checkbox" name="push_live_sessions" 
                                                   {{ 'checked' if user.notifications.push_live_sessions else '' }}>
                                            <span class="toggle-slider"></span>
                                        </label>
                                    </label>
                                </div>
                            </div>
                            
                            <div class="notification-section">
                                <h3>Frequency Settings</h3>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="digest_frequency" class="form-label">
                                            <i class="fas fa-clock"></i>
                                            Email Digest Frequency
                                        </label>
                                        <select id="digest_frequency" name="digest_frequency" class="form-select">
                                            <option value="daily" {{ 'selected' if user.notifications.digest_frequency == 'daily' else '' }}>Daily</option>
                                            <option value="weekly" {{ 'selected' if user.notifications.digest_frequency == 'weekly' else '' }}>Weekly</option>
                                            <option value="monthly" {{ 'selected' if user.notifications.digest_frequency == 'monthly' else '' }}>Monthly</option>
                                            <option value="never" {{ 'selected' if user.notifications.digest_frequency == 'never' else '' }}>Never</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="quiet_hours_start" class="form-label">
                                            <i class="fas fa-moon"></i>
                                            Quiet Hours (Start)
                                        </label>
                                        <input type="time" id="quiet_hours_start" name="quiet_hours_start" 
                                               class="form-input" value="{{ user.notifications.quiet_hours_start or '22:00' }}">
                                    </div>
                                    <div class="form-group">
                                        <label for="quiet_hours_end" class="form-label">
                                            <i class="fas fa-sun"></i>
                                            Quiet Hours (End)
                                        </label>
                                        <input type="time" id="quiet_hours_end" name="quiet_hours_end" 
                                               class="form-input" value="{{ user.notifications.quiet_hours_end or '08:00' }}">
                                    </div>
                                </div>
                            </div>
                            
                            <div class="form-actions">
                                <button type="button" class="btn btn-outline" onclick="resetForm('notifications-form')">
                                    <i class="fas fa-undo"></i>
                                    Reset
                                </button>
                                <button type="submit" class="btn btn-primary">
                                    <i class="fas fa-save"></i>
                                    Save Preferences
                                </button>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Achievements Tab -->
                <div class="tab-pane" id="achievements-tab">
                    <div class="settings-section">
                        <h2>Achievements & Badges</h2>
                        <p class="section-description">Track your learning milestones and unlock new achievements.</p>
                        
                        <div class="achievements-overview">
                            <div class="achievement-stats">
                                <div class="stat-card">
                                    <i class="fas fa-trophy"></i>
                                    <div class="stat-info">
                                        <span class="stat-number">{{ user_achievements.total_earned or 0 }}</span>
                                        <span class="stat-label">Badges Earned</span>
                                    </div>
                                </div>
                                <div class="stat-card">
                                    <i class="fas fa-certificate"></i>
                                    <div class="stat-info">
                                        <span class="stat-number">{{ user_achievements.certificates or 0 }}</span>
                                        <span class="stat-label">Certificates</span>
                                    </div>
                                </div>
                                <div class="stat-card">
                                    <i class="fas fa-star"></i>
                                    <div class="stat-info">
                                        <span class="stat-number">{{ user_achievements.points or 0 }}</span>
                                        <span class="stat-label">Total Points</span>
                                    </div>
                                </div>
                                <div class="stat-card">
                                    <i class="fas fa-chart-line"></i>
                                    <div class="stat-info">
                                        <span class="stat-number">{{ user_achievements.rank or 'Unranked' }}</span>
                                        <span class="stat-label">Global Rank</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="achievements-grid">
                            {% for achievement in user_achievements.earned %}
                            <div class="achievement-card earned">
                                <div class="achievement-icon">
                                    <i class="{{ achievement.icon }}"></i>
                                </div>
                                <div class="achievement-info">
                                    <h4>{{ achievement.name }}</h4>
                                    <p>{{ achievement.description }}</p>
                                    <div class="achievement-meta">
                                        <span class="earned-date">Earned {{ achievement.earned_date }}</span>
                                        <span class="achievement-points">+{{ achievement.points }} points</span>
                                    </div>
                                </div>
                            </div>
                            {% endfor %}
                            
                            {% for achievement in user_achievements.available %}
                            <div class="achievement-card available">
                                <div class="achievement-icon">
                                    <i class="{{ achievement.icon }}"></i>
                                </div>
                                <div class="achievement-info">
                                    <h4>{{ achievement.name }}</h4>
                                    <p>{{ achievement.description }}</p>
                                    <div class="achievement-progress">
                                        <div class="progress-bar">
                                            <div class="progress-fill" style="width: {{ achievement.progress }}%"></div>
                                        </div>
                                        <span class="progress-text">{{ achievement.current }}/{{ achievement.target }}</span>
                                    </div>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Success/Error Messages -->
    <div id="message-container" class="message-container" style="display: none;"></div>

    <!-- Scripts -->
    <script src="{{ url_for('static', path='/js/landing.js') }}"></script>
    <script src="{{ url_for('static', path='/js/profile.js') }}"></script>
    <script src="{{ url_for('static', path='/js/auth_manager.js') }}"></script>
</body>
</html>
